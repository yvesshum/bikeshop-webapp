<!DOCTYPE html>
<html>
<head>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:100,200,300,400,500,600,700,800,900" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/5.9.3/firebase.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.9.3/firebase-firestore.js"></script>
  <script>
  // Initialize Firebase, this is always necessary
  var config = {
    apiKey: "AIzaSyA39Jp3rVTwBrn__rkjbAFp2EZalfZVHYs",
    authDomain: "bikeshoptesting-9e034.firebaseapp.com",
    databaseURL: "https://bikeshoptesting-9e034.firebaseio.com",
    projectId: "bikeshoptesting-9e034",
    storageBucket: "bikeshoptesting-9e034.appspot.com",
    messagingSenderId: "50618401035"
  };
  firebase.initializeApp(config);
  firebase.auth().signInWithEmailAndPassword("yvesshum@uchicago.edu","techteam");
  </script>
  <title>Edits</title>
</head>

<style media="screen">
body {
  font-family: Montserrat;
}
</style>

<body>
  <h2>Edit Profile</h2>
  <form id = "edit_form">
    <p>
      ID <br>
      <input type="text" name="ID_field" id="ID_field" value="Test2">
    </p>
    <p>
      Name <br>
      <input type="text" name="Name_edit" id="Name_edit" value="John Smith">
    </p>
    <p>
      DOB <br>
      <input type="text" name="DOB_edit" id="DOB_edit" value="2000-01-01">
    </p>
    <button type="submit">Submit Edits</button>
  </form>

  <script>
  //Reference firebase database
  var db = firebase.firestore();

  // Listen for form submit
  const edit = document.getElementById("edit_form");

  // Upon submitting form, checks if there are edits
  edit.addEventListener("submit", check_edits);

  //==================== FUNCTIONS =====================//

  //FUNCTION to check if form changes with edit
  //Parameters: called upon form submission
  function check_edits(event) {
    event.preventDefault();
    // @Vince change this to: document.getElementById("ID_Field").innerHTML
    var youth_id = document.getElementById("ID_field").value;
    const form = document.getElementById("edit_form");
    var n;
    var c = false;

    // subtract 1 from form length because of button at the end
    var el = form.elements.length - 1;
    console.log(el);  // Displays the number of fields in edit form
    for (var e = 0; e < el; e++) {
      n = form.elements[e];
      console.log(n);  // Displays the form elements
      c = c || (n.value != n.defaultValue);
    }

    if (c == true) {
      alert("The edits have been saved");
      saveEdit(youth_id);
    } else {
      alert("No edits have been made");
    }
  }

  // FUNCTION that saves edits to firebase, called by check_edits upon
  // determination that actual edits were made
  // Parameters: ID of youth
  async function saveEdit(id){
    // creates an object to store edited values
    var changes = new Object();

    // @Vince You might want to delete the next three lines of code
    var youthRef = db.collection('GlobalYouthProfile').doc(id);
    let data = await youthRef.get();
    // Gets the field names in the specified youth id document
    data = data.data();

    console.log("ORIGINAL FIELD VALUES:")
    console.log(data);
    console.log("FIELD VALUES TO BE SUBMITTED:")
    for (key in data) {
      console.log(key);
      // Adds current value of field "d" in form to changes object
      changes[key] = document.getElementById(key + "_edit").value;
      console.log(changes[key]);
    }

    console.log(changes);
    // Saves edits to firebase
    youthRef.update(changes);
  }

  </script>
</body>
</html>
